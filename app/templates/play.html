<!DOCTYPE html>
<html>
<head>
  <title>Review</title>
</head>
<body style="text-align:center; font-family:sans-serif;">
  <div style="margin: 50px auto; max-width: 600px;">
    <p><em>{{ prev_text }}</em></p>
    <p><strong>{{ curr_text }}</strong></p>
    <p><em>{{ next_text }}</em></p>

    <br>
    <div style="font-size: 1em;">
      ⏱️ <span id="timer_ui">00:00</span>
    </div>
    <br>

    <form id="answer-form" action="/submit" method="post">
      <input type="hidden" name="actual_ref" value="{{ reference }}">
      <input type="hidden" name="session_id" value="{{ session_id }}">

      {% set parts = reference.rsplit(' ', 1) %}
      {% set book = parts[0] %}
      {% set ch_verse = parts[1].split(':') %}
      {% set chapter = ch_verse[0] %}
      {% set verse = ch_verse[1] %}

      <input type="hidden" name="book" value="{{ book }}">
      <input type="hidden" name="chapter" value="{{ chapter }}">
      <input type="hidden" name="verse" value="{{ verse }}">
      <input type="hidden" name="timer" id="timer" value="0">

      <input type="text" name="submitted_ref" placeholder="Reference"
            style="width: 30%; font-size: 1em;" autofocus required>
      <br><br>
      <button type="submit" style="font-size: 1em;">Submit</button>
    </form>
  </div>

  <script>
    let startTime = Date.now();
    const timerSpan = document.getElementById("timer_ui");
    const elapsedInput = document.getElementById("timer");

    function formatTime(seconds) {
      const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
      const secs = String(seconds % 60).padStart(2, '0');
      return `${mins}:${secs}`;
    }

    function updateTimer() {
      const now = Date.now();
      const seconds = Math.floor((now - startTime) / 1000);
      timerSpan.textContent = formatTime(seconds);
      elapsedInput.value = seconds;
    }

    const intervalId = setInterval(updateTimer, 1000);

    document.getElementById("answer-form").addEventListener("submit", () => {
      clearInterval(intervalId);
      updateTimer();
    });
  </script>
</body>
</html>
